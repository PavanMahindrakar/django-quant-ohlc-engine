<!DOCTYPE html>
<html>
<head>
    <title>{{ symbol }} Option Chain</title>

    <meta http-equiv="refresh" content="300">

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #111827;
            color: #f9fafb;
            margin: 0;
            padding: 20px;
        }

        h2, h3 {
            text-align: center;
            margin: 5px;
        }

        .analytics {
            margin-top: 15px;
            text-align: center;
            font-size: 14px;
            padding: 12px;
            background-color: #1f2937;
            border-radius: 6px;
        }

        .analytics span {
            margin: 0 15px;
        }

        .bullish { color: #10b981; }
        .bearish { color: #ef4444; }
        .neutral { color: #facc15; }

        .footer {
            text-align: center;
            margin-top: 8px;
            font-size: 12px;
            color: #9ca3af;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
        }

        th {
            background-color: #1f2937;
            padding: 10px;
            font-size: 13px;
            border-bottom: 2px solid #374151;
        }

        td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #374151;
            font-size: 13px;
        }

        tr:hover {
            background-color: #1f2937;
        }

        .ce { color: #10b981; }
        .pe { color: #ef4444; }

        .atm {
            background-color: #1e3a8a;
            font-weight: bold;
        }

        .section-header {
            background-color: #0f172a;
            color: #9ca3af;
            font-size: 12px;
        }

        .strike-col {
            font-weight: bold;
            color: #ffffff;
        }

        .positive { color: #10b981; }
        .negative { color: #ef4444; }

        .build-long { color: #10b981; font-weight: bold; }
        .build-short { color: #ef4444; font-weight: bold; }
        .build-cover { color: #60a5fa; font-weight: bold; }
        .build-unwind { color: #facc15; font-weight: bold; }
        .build-neutral { color: #9ca3af; }
    </style>
</head>

<body>

<h2>{{ symbol }} - {{ expiry }}</h2>
<h3>Spot: {{ spot }}</h3>

<div class="analytics">
    <span>
        PCR:
        {% if pcr > 1 %}
            <span class="bullish">{{ pcr }}</span>
        {% elif pcr < 1 %}
            <span class="bearish">{{ pcr }}</span>
        {% else %}
            <span class="neutral">{{ pcr }}</span>
        {% endif %}
    </span>

    <span>Max Pain: <b>{{ max_pain }}</b></span>
    <span>Resistance: <b>{{ highest_call_oi }}</b></span>
    <span>Support: <b>{{ highest_put_oi }}</b></span>
</div>

<div class="footer">Last Updated: {{ timestamp }}</div>

<table>

    <!-- Section Header -->
    <tr class="section-header">
        <th colspan="7">CALLS</th>
        <th>STRIKE</th>
        <th colspan="7">PUTS</th>
    </tr>

    <!-- Column Headers -->
    <tr>
        <th>OI</th>
        <th>ΔOI</th>
        <th>LTP</th>
        <th>Δ</th>
        <th>Θ</th>
        <th>IV</th>
        <th>Build</th>

        <th></th>

        <th>Build</th>
        <th>IV</th>
        <th>Θ</th>
        <th>Δ</th>
        <th>LTP</th>
        <th>ΔOI</th>
        <th>OI</th>
    </tr>

    {% for item in chain %}
    <tr {% if item.strikePrice|floatformat:0 == spot|floatformat:0 %} class="atm" {% endif %}>

        <!-- CALL SIDE -->
        <td class="ce">{{ item.CE.openInterest|default:0 }}</td>

        <td class="{% if item.CE.oiChange > 0 %}positive{% elif item.CE.oiChange < 0 %}negative{% endif %}">
            {{ item.CE.oiChange|default:0 }}
        </td>

        <td class="ce">{{ item.CE.lastPrice|default:0 }}</td>
        <td class="ce">{{ item.CE.delta|default:0 }}</td>
        <td class="ce">{{ item.CE.theta|default:0 }}</td>
        <td class="ce">{{ item.CE.iv|default:0 }}</td>

        <td class="
            {% if item.CE.buildUp == 'Long Build-Up' %}build-long
            {% elif item.CE.buildUp == 'Short Build-Up' %}build-short
            {% elif item.CE.buildUp == 'Short Covering' %}build-cover
            {% elif item.CE.buildUp == 'Long Unwinding' %}build-unwind
            {% else %}build-neutral{% endif %}
        ">
            {{ item.CE.buildUp|default:"-" }}
        </td>

        <!-- STRIKE -->
        <td class="strike-col">{{ item.strikePrice }}</td>

        <!-- PUT SIDE -->
        <td class="
            {% if item.PE.buildUp == 'Long Build-Up' %}build-long
            {% elif item.PE.buildUp == 'Short Build-Up' %}build-short
            {% elif item.PE.buildUp == 'Short Covering' %}build-cover
            {% elif item.PE.buildUp == 'Long Unwinding' %}build-unwind
            {% else %}build-neutral{% endif %}
        ">
            {{ item.PE.buildUp|default:"-" }}
        </td>

        <td class="pe">{{ item.PE.iv|default:0 }}</td>
        <td class="pe">{{ item.PE.theta|default:0 }}</td>
        <td class="pe">{{ item.PE.delta|default:0 }}</td>
        <td class="pe">{{ item.PE.lastPrice|default:0 }}</td>

        <td class="{% if item.PE.oiChange > 0 %}positive{% elif item.PE.oiChange < 0 %}negative{% endif %}">
            {{ item.PE.oiChange|default:0 }}
        </td>

        <td class="pe">{{ item.PE.openInterest|default:0 }}</td>

    </tr>
    {% endfor %}

</table>

</body>
</html>